<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Inform modern browsers that this page supports both dark and light color schemes,
  and the page author prefers light. --><meta name="color-scheme" content="dark light">
<script>
  // If `prefers-color-scheme` is not supported, fall back to light mode.
  // i.e. In this case, inject the `light` CSS before the others, with
  // no media filter so that it will be downloaded with highest priority.
  if (window.matchMedia("(prefers-color-scheme: dark)").media === "not all") {
    document.documentElement.style.display = "none";
    document.head.insertAdjacentHTML(
      "beforeend",
      "<link id=\"css\" rel=\"stylesheet\" href=\"https://bootswatch.com/3/flatly/bootstrap.css\" onload=\"document.documentElement.style.display = ''\">"
    );
  }
</script><title>1. Download and process NLDAS • StreamLight</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- Flatly Theme - Light  --><link id="css-light" rel="stylesheet" href="https://bootswatch.com/3/flatly/bootstrap.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<!-- Darkly Theme - Dark --><link id="css-dark" rel="stylesheet" href="https://bootswatch.com/3/darkly/bootstrap.css" media="(prefers-color-scheme: dark)">
<!-- preferably CSS --><link rel="stylesheet" href="../preferably.css">
<link id="css-code-light" rel="stylesheet" href="../code-color-scheme-light.css" media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)">
<link id="css-code-dark" rel="stylesheet" href="../code-color-scheme-dark.css" media="(prefers-color-scheme: dark)">
<script src="../darkswitch.js"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="1. Download and process NLDAS">
<meta property="og:description" content="StreamLight">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">StreamLight</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/1%20Download%20and%20process%20NLDAS.html">1. Download and process NLDAS</a>
    </li>
    <li>
      <a href="../articles/2%20Download%20and%20process%20MODIS%20LAI.html">2. Download and process MODIS LAI</a>
    </li>
    <li>
      <a href="../articles/3%20Using%20stream_light.html">3. Using stream_light</a>
    </li>
    <li>
      <a href="../articles/4%20Using%20aqua_light.html">4. Using aqua_light</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
          <a href="#" id="css-toggle-btn">
            <span class="fas fa-adjust fa-lg"></span>
          </a>
        </li>
        
        <li>
  <a href="https://github.com/psavoy/StreamLight/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
        
        


      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="1%20Download%20and%20process%20NLDAS_files/header-attrs-2.8/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>1. Download and process NLDAS</h1>
                        <h4 class="author">Phil Savoy</h4>
            
            <h4 class="date">5/17/2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/psavoy/StreamLight/blob/master/vignettes/1%20Download%20and%20process%20NLDAS.Rmd"><code>vignettes/1 Download and process NLDAS.Rmd</code></a></small>
      <div class="hidden name"><code>1 Download and process NLDAS.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This article describes downloading and processing total incoming shortwave radiation (W m<sup>-2</sup>) using the <strong>StreamLightUtils</strong> package. Total incoming shortwave radiation (W m<sup>-2</sup>) is provided by the National Land Data Assimilation System (NLDAS) at hourly timesteps at 0.125 degree spatial resolution. There are two potential workflows available: 1.) download data for a single site, and 2.) bulk download of data for many sites.</p>
<div id="downloading-and-processing-nldas-data-for-a-single-site" class="section level2">
<h2 class="hasAnchor">
<a href="#downloading-and-processing-nldas-data-for-a-single-site" class="anchor"></a>1. Downloading and processing NLDAS data for a single site</h2>
<p>Incoming shortwave radiation data at a single site can be downloaded using the function <strong><span style="color:DarkOrange">NLDAS_DL</span></strong> which has the following structure:</p>
<p><strong><span style="color:DarkOrange">NLDAS_DL</span></strong>(<em><span style="color:#009faf">save_dir</span></em>, <em><span style="color:#009faf">Site_ID</span></em>, <em><span style="color:#009faf">Lat</span></em>, <em><span style="color:#009faf">Lon</span></em>, <em><span style="color:#009faf">startDate</span></em>)</p>
<ul>
<li>
<em><span style="color:#009faf">save_dir</span></em> The save directory for the downloaded data to be placed in. For example, “C:/”</li>
<li>
<em><span style="color:#009faf">Site_ID</span></em> The site identifier (“Site_ID”)</li>
<li>
<em><span style="color:#009faf">Lat</span></em> The site latitude</li>
<li>
<em><span style="color:#009faf">Lon</span></em> The site longitude</li>
<li>
<em><span style="color:#009faf">startDate</span></em> The start date for the downloaded data (“YYYY-MM-DD”)</li>
</ul>
<p>Once the data has been downloaded it requires some processing to format date and time information and extract the relevant data. The downloaded NLDAS data can be processed using the function <strong><span style="color:DarkOrange">NLDAS_proc</span></strong> which has the following structure:</p>
<p><strong><span style="color:DarkOrange">NLDAS_proc</span></strong>(<em><span style="color:#009faf">read_dir</span></em>, <em><span style="color:#009faf">Site_IDs</span></em>)</p>
<ul>
<li>
<em><span style="color:#009faf">read_dir</span></em> The directory containing the downloaded NLDAS data</li>
<li>
<em><span style="color:#009faf">Site_IDs</span></em> The Site ID(s) (“Site_ID”) <em><span style="color:#009faf">write_output</span></em> A logical value indicating whether the output should be written to disk (write_output = TRUE) or returned to the R environment (write_output = FALSE). The default value is FALSE since for most datasets this is a suitable approach; however, for very large datasets (thousands of sites) it may be easier to write files to disk instead of storing them in the workspace.</li>
<li>
<em><span style="color:#009faf">save_dir</span></em> An optional parameter to use only when write_output = TRUE that indicates the save directory for files to be placed in. For example, "C:/</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Set the download location (add your own directory)</span>
  <span class="va">working_dir</span> <span class="op">&lt;-</span> <span class="st">"C:/"</span>
    
<span class="co">#Download NLDAS data at NC_NHC</span>
  <span class="fu"><a href="https://rdrr.io/pkg/StreamLightUtils/man/NLDAS_DL.html">NLDAS_DL</a></span><span class="op">(</span>
    save_dir <span class="op">=</span> <span class="va">working_dir</span>,
    Site_ID <span class="op">=</span> <span class="st">"NC_NHC"</span>,
    Lat <span class="op">=</span> <span class="fl">35.9925</span>, 
    Lon <span class="op">=</span> <span class="op">-</span><span class="fl">79.0460</span>, 
    startDate <span class="op">=</span> <span class="st">"2017-01-01"</span>
  <span class="op">)</span>
  
<span class="co">#Process the downloaded data</span>
  <span class="va">NLDAS_processed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/StreamLightUtils/man/NLDAS_proc.html">NLDAS_proc</a></span><span class="op">(</span>
    read_dir <span class="op">=</span> <span class="va">working_dir</span>, 
    Site_IDs <span class="op">=</span> <span class="st">"NC_NHC"</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="downloading-and-processing-nldas-data-for-multiple-sites" class="section level2">
<h2 class="hasAnchor">
<a href="#downloading-and-processing-nldas-data-for-multiple-sites" class="anchor"></a>2. Downloading and processing NLDAS data for multiple sites</h2>
<p>Incoming shortwave radiation data at multiple sites can be downloaded using the function <strong><span style="color:DarkOrange">NLDAS_DL_bulk</span></strong> which has the following structure:</p>
<p><strong><span style="color:DarkOrange">NLDAS_DL_bulk</span></strong>(<em><span style="color:#009faf">save_dir</span></em>, <em><span style="color:#009faf">site_locs</span></em>, <em><span style="color:#009faf">startDate</span></em>)</p>
<ul>
<li>
<em><span style="color:#009faf">save_dir</span></em> The save directory for the downloaded data to be placed in. For example, “C:/”</li>
<li>
<em><span style="color:#009faf">site_locs</span></em> A table with Site_ID, Lat, and Lon, and startDate</li>
<li>
<em><span style="color:#009faf">startDate</span></em> An optional parameter. By default, if nothing is provided the function assumes that site_locs has a column that contains startDate. Alternatively, a single startDate can be provided as an argument for the download (YYYY-MM-DD)</li>
</ul>
<p>Recall from earlier that our table of site information has a column called <strong><span style="color:#009688">“startDate”</span></strong>, so here the optional parameter is not used. If data fails to download for a site, the <strong><span style="color:DarkOrange">NLDAS_DL_bulk</span></strong> function will automatically check and retry downloading data for all sites with missing data. However, it is possible that data does not exist for a site. Consequently, it is prudent to confirm the successfully downloaded sites.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Read in a table with initial site information</span>
  <span class="va">sites</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">NC_site_basic</span><span class="op">)</span>

<span class="co">#Download NLDAS data at NC_NHC</span>
  <span class="fu"><a href="https://rdrr.io/pkg/StreamLightUtils/man/NLDAS_DL_bulk.html">NLDAS_DL_bulk</a></span><span class="op">(</span>
    save_dir <span class="op">=</span> <span class="va">working_dir</span>,
    site_locs <span class="op">=</span> <span class="va">sites</span>
  <span class="op">)</span>

<span class="co">#List of successfully downloaded sites</span>
  <span class="va">NLDAS_list</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_sub.html">str_sub</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="va">working_dir</span><span class="op">)</span>, <span class="fl">1</span>, <span class="op">-</span><span class="fl">11</span><span class="op">)</span>
  
<span class="co">#Processing the downloaded NLDAS data</span>
  <span class="va">NLDAS_processed</span> <span class="op">&lt;-</span> <span class="fu">StreamLightUtils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/StreamLightUtils/man/NLDAS_proc.html">NLDAS_proc</a></span><span class="op">(</span>read_dir <span class="op">=</span> <span class="va">working_dir</span>, <span class="va">NLDAS_list</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Phil Savoy.</p>
</div>

<div class="pkgdown">
  <p>Made with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1, using <a href="https://preferably.amirmasoudabdol.name/?source=footer">preferably</a> template.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
